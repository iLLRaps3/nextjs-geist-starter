<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>THCA Store Admin Panel</title>
    <link rel="stylesheet" href="/static/styles.css" />
    <style>
        body {
            max-width: 900px;
            margin: 20px auto;
            font-family: Arial, sans-serif;
            background-color: #f9f9f9;
            color: #333;
        }
        h1, h2 {
            color: #27ae60;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        table, th, td {
            border: 1px solid #ddd;
        }
        th, td {
            padding: 10px;
            text-align: left;
        }
        th {
            background-color: #27ae60;
            color: white;
        }
        input[type="text"], input[type="number"], textarea {
            width: 100%;
            padding: 8px;
            margin: 4px 0 10px 0;
            box-sizing: border-box;
        }
        button {
            background-color: #27ae60;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            margin-right: 10px;
        }
        button:hover {
            background-color: #219150;
        }
        .actions button {
            margin-right: 5px;
        }
        #sales-log {
            max-height: 200px;
            overflow-y: auto;
            background: #fff;
            border: 1px solid #ddd;
            padding: 10px;
            font-family: monospace;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>THCA Store Admin Panel</h1>

    <section id="inventory-management">
        <h2>Inventory Management</h2>
        <form id="product-form">
            <input type="hidden" id="product-id" />
            <label for="product-name">Name:</label>
            <input type="text" id="product-name" required />
            <label for="product-description">Description:</label>
            <textarea id="product-description" rows="3" required></textarea>
            <label for="product-price">Price ($):</label>
            <input type="number" id="product-price" step="0.01" min="0" required />
            <label for="product-image">Image URL:</label>
            <input type="text" id="product-image" required />
            <button type="submit" id="save-product-btn">Add Product</button>
            <button type="button" id="cancel-edit-btn" style="display:none;">Cancel</button>
        </form>

        <table id="product-table">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Description</th>
                    <th>Price ($)</th>
                    <th>Image</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <!-- Products will be listed here -->
            </tbody>
        </table>
    </section>

    <section id="sales-management">
        <h2>Sales Log</h2>
        <div id="sales-log">
            No sales yet.
        </div>
    </section>

    <script>
        let products = JSON.parse(localStorage.getItem('adminProducts')) || [];
        let sales = JSON.parse(localStorage.getItem('adminSales')) || [];

        const productForm = document.getElementById('product-form');
        const productIdInput = document.getElementById('product-id');
        const productNameInput = document.getElementById('product-name');
        const productDescriptionInput = document.getElementById('product-description');
        const productPriceInput = document.getElementById('product-price');
        const productImageInput = document.getElementById('product-image');
        const saveProductBtn = document.getElementById('save-product-btn');
        const cancelEditBtn = document.getElementById('cancel-edit-btn');
        const productTableBody = document.querySelector('#product-table tbody');
        const salesLogDiv = document.getElementById('sales-log');

        function renderProducts() {
            productTableBody.innerHTML = '';
            products.forEach((product, index) => {
                const tr = document.createElement('tr');
                tr.innerHTML = \`
                    <td>\${product.name}</td>
                    <td>\${product.description}</td>
                    <td>\${product.price.toFixed(2)}</td>
                    <td><img src="\${product.image}" alt="\${product.name}" style="max-width: 80px; border-radius: 5px;" /></td>
                <td class="actions">
                        <button onclick="editProduct(${index})">Edit</button>
                        <button onclick="deleteProduct(${index})">Delete</button>
                    </td>
                `;
                productTableBody.appendChild(tr);
            });
        }

        function renderSales() {
            if (sales.length === 0) {
                salesLogDiv.textContent = 'No sales yet.';
                return;
            }
        salesLogDiv.textContent = sales.map(sale => `Order #${sale.id}: ${sale.items.map(i => i.name + ' x' + i.quantity).join(', ')} - Total: $${sale.total.toFixed(2)}`).join('\n');
        }

        function saveProductsToStorage() {
            localStorage.setItem('adminProducts', JSON.stringify(products));
        }

        function saveSalesToStorage() {
            localStorage.setItem('adminSales', JSON.stringify(sales));
        }

        productForm.addEventListener('submit', e => {
            e.preventDefault();
            const id = productIdInput.value;
            const name = productNameInput.value.trim();
            const description = productDescriptionInput.value.trim();
            const price = parseFloat(productPriceInput.value);
            const image = productImageInput.value.trim();

            if (!name || !description || isNaN(price) || !image) {
                alert('Please fill in all fields correctly.');
                return;
            }

            if (id) {
                // Edit existing product
                products[id] = { name, description, price, image };
                saveProductBtn.textContent = 'Add Product';
                cancelEditBtn.style.display = 'none';
            } else {
                // Add new product
                products.push({ name, description, price, image });
            }

            saveProductsToStorage();
            renderProducts();
            productForm.reset();
            productIdInput.value = '';
        });

        cancelEditBtn.addEventListener('click', () => {
            productForm.reset();
            productIdInput.value = '';
            saveProductBtn.textContent = 'Add Product';
            cancelEditBtn.style.display = 'none';
        });

        window.editProduct = function(index) {
            const product = products[index];
            productIdInput.value = index;
            productNameInput.value = product.name;
            productDescriptionInput.value = product.description;
            productPriceInput.value = product.price;
            productImageInput.value = product.image;
            saveProductBtn.textContent = 'Save Changes';
            cancelEditBtn.style.display = 'inline-block';
        };

        window.deleteProduct = function(index) {
            if (confirm('Are you sure you want to delete this product?')) {
                products.splice(index, 1);
                saveProductsToStorage();
                renderProducts();
            }
        };

        // Listen for sales from main store page via localStorage event
        window.addEventListener('storage', (event) => {
            if (event.key === 'newSale') {
                const sale = JSON.parse(event.newValue);
                sales.push(sale);
                saveSalesToStorage();
                renderSales();
            }
        });

        renderProducts();
        renderSales();
    </script>
</body>
</html>
